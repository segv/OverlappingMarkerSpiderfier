(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2013 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Google Maps API v3 must be included *before* this code
*/
var B={}.hasOwnProperty,C=[].slice;
this.OverlappingMarkerSpiderfier=function(){function w(b,c){var a,g,e,f;this.map=b;null==c&&(c={});for(a in c)B.call(c,a)&&(g=c[a],this[a]=g);this.e=new this.constructor.g(this.map);this.n();this.b={};f=["click","zoom_changed","maptypeid_changed"];g=0;for(e=f.length;g<e;g++)a=f[g],q.addListener(this.map,a,function(b){return function(){return b.unspiderfy()}}(this))}var q,s,x,t,u,z,r,d,y,v,A;d=w.prototype;y=[w,d];x=0;for(z=y.length;x<z;x++)A=y[x],A.VERSION="0.3.3";r=q=s=void 0;v=2*Math.PI;d.keepSpiderfied=
!1;d.markersWontHide=!1;d.markersWontMove=!1;d.nearbyDistance=20;d.circleSpiralSwitchover=9;d.circleFootSeparation=23;d.circleStartAngle=v/12;d.spiralFootSeparation=26;d.spiralLengthStart=11;d.spiralLengthFactor=4;d.spiderfiedZIndex=1E3;d.usualLegZIndex=10;d.highlightedLegZIndex=20;d.event="click";d.minZoomLevel=!1;d.legWeight=1.5;d.legColors={usual:{},highlighted:{}};u=d.legColors.usual;t=d.legColors.highlighted;w.initializeGoogleMaps=function(b){s=b.maps;q=s.event;r=s.MapTypeId;u[r.HYBRID]=u[r.SATELLITE]=
"#fff";t[r.HYBRID]=t[r.SATELLITE]="#f00";u[r.TERRAIN]=u[r.ROADMAP]="#444";t[r.TERRAIN]=t[r.ROADMAP]="#f00";this.g=function(b){return this.setMap(b)};this.g.prototype=new s.OverlayView;return this.g.prototype.draw=function(){}};d.n=function(){this.a=[];this.j=[]};d.addMarker=function(b){var c;if(null!=b._oms)return this;b._oms=!0;c=[q.addListener(b,this.event,function(a){return function(c){return a.G(b,c)}}(this))];this.markersWontHide||c.push(q.addListener(b,"visible_changed",function(a){return function(){return a.o(b,
!1)}}(this)));this.markersWontMove||c.push(q.addListener(b,"position_changed",function(a){return function(){return a.o(b,!0)}}(this)));this.j.push(c);this.a.push(b);return this};d.o=function(b,c){if(null!=b._omsData&&(c||!b.getVisible())&&null==this.s&&null==this.t)return this.unspiderfy(c?b:null)};d.getMarkers=function(){return this.a.slice(0)};d.removeMarker=function(b){var c,a,g,e,f;null!=b._omsData&&this.unspiderfy();c=this.m(this.a,b);if(0>c)return this;f=this.j.splice(c,1)[0];a=0;for(g=f.length;a<
g;a++)e=f[a],q.removeListener(e);delete b._oms;this.a.splice(c,1);return this};d.clearMarkers=function(){var b,c,a,g,e,f,d,h;this.unspiderfy();h=this.a;b=c=0;for(a=h.length;c<a;b=++c){f=h[b];e=this.j[b];d=0;for(b=e.length;d<b;d++)g=e[d],q.removeListener(g);delete f._oms}this.n();return this};d.addListener=function(b,c){var a;(null!=(a=this.b)[b]?a[b]:a[b]=[]).push(c);return this};d.removeListener=function(b,c){var a;a=this.m(this.b[b],c);0>a||this.b[b].splice(a,1);return this};d.clearListeners=function(b){this.b[b]=
[];return this};d.trigger=function(){var b,c,a,g,e,f;c=arguments[0];b=2<=arguments.length?C.call(arguments,1):[];c=null!=(a=this.b[c])?a:[];f=[];g=0;for(e=c.length;g<e;g++)a=c[g],f.push(a.apply(null,b));return f};d.u=function(b,c){var a,g,e,f,d;f=this.circleFootSeparation*(2+b)/v;g=v/b;d=[];for(a=e=0;0<=b?e<b:e>b;a=0<=b?++e:--e)a=this.circleStartAngle+a*g,d.push(new s.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)));return d};d.v=function(b,c){var a,g,e,f,d;f=this.spiralLengthStart;a=0;d=[];for(g=e=0;0<=
b?e<b:e>b;g=0<=b?++e:--e)a+=this.spiralFootSeparation/f+5E-4*g,g=new s.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)),f+=v*this.spiralLengthFactor/a,d.push(g);return d};d.G=function(b,c){var a,g,e,f,k,h,m,l,n,p;l=null!=b._omsData;l&&this.keepSpiderfied||("mouseover"===this.event?(a=this,g=function(){return a.unspiderfy()},window.clearTimeout(d.timeout),d.timeout=setTimeout(g,3E3)):this.unspiderfy());if(l||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",
b,c);g=[];l=[];e=this.nearbyDistance;n=e*e;m=this.c(b.position);p=this.a;e=0;for(f=p.length;e<f;e++)k=p[e],null!=k.map&&k.getVisible()&&(h=this.c(k.position),this.f(h,m)<n?g.push({B:k,p:h}):l.push(k));return 1===g.length?this.trigger("click",b,c):this.H(g,l)};d.markersNearMarker=function(b,c){var a,g,e,d,k,h,m,l,n,p;null==c&&(c=!1);if(null==this.e.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";a=this.nearbyDistance;m=a*a;k=this.c(b.position);h=[];l=this.a;
a=0;for(g=l.length;a<g&&!(e=l[a],e!==b&&null!=e.map&&e.getVisible()&&(d=this.c(null!=(n=null!=(p=e._omsData)?p.l:void 0)?n:e.position),this.f(d,k)<m&&(h.push(e),c)));a++);return h};d.markersNearAnyOtherMarker=function(){var b,c,a,g,e,d,k,h,m,l,n,p;if(null==this.e.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";l=this.nearbyDistance;b=l*l;d=this.a;l=[];n=0;for(a=d.length;n<a;n++)c=d[n],l.push({q:this.c(null!=(g=null!=(e=c._omsData)?e.l:void 0)?g:c.position),
d:!1});n=this.a;c=g=0;for(e=n.length;g<e;c=++g)if(a=n[c],null!=a.map&&a.getVisible()&&(k=l[c],!k.d))for(p=this.a,a=m=0,d=p.length;m<d;a=++m)if(h=p[a],a!==c&&null!=h.map&&h.getVisible()&&(h=l[a],(!(a<c)||h.d)&&this.f(k.q,h.q)<b)){k.d=h.d=!0;break}n=this.a;a=[];b=e=0;for(g=n.length;e<g;b=++e)c=n[b],l[b].d&&a.push(c);return a};d.A=function(b){return{h:function(c){return function(){return b._omsData.i.setOptions({strokeColor:c.legColors.highlighted[c.map.mapTypeId],zIndex:c.highlightedLegZIndex})}}(this),
k:function(c){return function(){return b._omsData.i.setOptions({strokeColor:c.legColors.usual[c.map.mapTypeId],zIndex:c.usualLegZIndex})}}(this)}};d.H=function(b,c){var a,d,e,f,k,h,m,l,n,p;if(this.minZoomLevel&&this.map.getZoom()<this.minZoomLevel)return!1;this.s=!0;p=b.length;a=this.D(function(){var a,c,e;e=[];a=0;for(c=b.length;a<c;a++)l=b[a],e.push(l.p);return e}());f=p>=this.circleSpiralSwitchover?this.v(p,a).reverse():this.u(p,a);a=function(){var a,c,l;l=[];a=0;for(c=f.length;a<c;a++)e=f[a],
d=this.F(e),n=this.C(b,function(a){return function(b){return a.f(b.p,e)}}(this)),m=n.B,h=new s.Polyline({map:this.map,path:[m.position,d],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),m._omsData={l:m.position,i:h},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(k=this.A(m),m._omsData.w={h:q.addListener(m,"mouseover",k.h),k:q.addListener(m,"mouseout",k.k)}),m.setPosition(d),m.setZIndex(Math.round(this.spiderfiedZIndex+
e.y)),l.push(m);return l}.call(this);delete this.s;this.r=!0;return this.trigger("spiderfy",a,c)};d.unspiderfy=function(b){var c,a,d,e,f,k,h;null==b&&(b=null);if(null==this.r)return this;this.t=!0;h=[];f=[];k=this.a;c=0;for(a=k.length;c<a;c++)e=k[c],null!=e._omsData?(e._omsData.i.setMap(null),e!==b&&e.setPosition(e._omsData.l),e.setZIndex(null),d=e._omsData.w,null!=d&&(q.removeListener(d.h),q.removeListener(d.k)),delete e._omsData,h.push(e)):f.push(e);delete this.t;delete this.r;this.trigger("unspiderfy",
h,f);return this};d.f=function(b,c){var a,d;a=b.x-c.x;d=b.y-c.y;return a*a+d*d};d.D=function(b){var c,a,d,e,f;c=e=f=0;for(a=b.length;c<a;c++)d=b[c],e+=d.x,f+=d.y;b=b.length;return new s.Point(e/b,f/b)};d.c=function(b){return this.e.getProjection().fromLatLngToDivPixel(b)};d.F=function(b){return this.e.getProjection().fromDivPixelToLatLng(b)};d.C=function(b,c){var a,d,e,f,k,h;e=k=0;for(h=b.length;k<h;e=++k)if(f=b[e],f=c(f),"undefined"===typeof a||null===a||f<d)d=f,a=e;return b.splice(a,1)[0]};d.m=
function(b,c){var a,d,e,f;if(null!=b.indexOf)return b.indexOf(c);a=d=0;for(e=b.length;d<e;a=++d)if(f=b[a],f===c)return a;return-1};return w}();})();
